# üìä Diagramas de Flujo ‚Äì TODOFERRETERO

Este documento, contiene diagramas que representan un grafo (generado en **ddraw.io** y exportado a .PNG) de dependencias de cada uno de los m√≥dulos analizados. Cada nodo corresponde a una funci√≥n o m√©todo definido en el c√≥digo fuente y se organiza dentro de un swimlane por m√≥dulo.

El contenido se presenta en este orden:

-Link al archivo draw.io
-Se muestra el .png exportado desde el archivo draw.io

    Simbolog√≠a de los flujos:

    - Las aristas s√≥lidas indican invocaciones internas dentro del mismo m√≥dulo
    - Las aristas punteadas amarillas, se√±alan llamadas entre diferentes m√≥dulos .py
    - Las aristas punteadas verdes, se√±alan lecturas a la Base de datos
    - Las aristas punteadas rojas, se√±alan escrituras a la Base de datos

Adem√°s, se incluyen las fuentes de datos detectadas (como bases de datos SQLite) y las operaciones SQL relevantes (SELECT, INSERT, UPDATE, DELETE).

Tambi√©n se identifican eventos de interfaz (ej. on_release, bind en Kivy) que act√∫an como disparadores entre componentes. De esta manera, el diagrama proporciona una visi√≥n general de c√≥mo las funciones del m√≥dulo interact√∫an entre s√≠, con otros archivos .py y con las fuentes de datos externas.

Los archivos ".py" contenidos en este segmento de la documentaci√≥n, son:

    - login.py
    - tomar_pedido.py
    - resumen_cliente.py
    - carrito.py
    - historial.py
    - pdf_pedido.py

---

## üîë Login - (login.py)

***Descripci√≥n:***
Este diagrama muestra el flujo de autenticaci√≥n implementado en el m√≥dulo login (login.py).

Las aristas s√≥lidas representan la l√≥gica interna del m√≥dulo, incluyendo la inicializaci√≥n de la interfaz y la verificaci√≥n de campos, mientras que las aristas punteadas en color amarillo, se√±alan las llamadas a otros m√≥dulos, como la transici√≥n hacia tomar_pedido cuando el inicio de sesi√≥n es exitoso.

El grafo tambi√©n refleja las consultas SQL sobre todoferre.db (particularmente operaciones SELECT), que permiten confirmar la existencia del usuario y validar su acceso.

Adem√°s, se destacan los eventos de interfaz (on_release, bind) vinculados a botones como ‚ÄúIngresar‚Äù o ‚ÄúVolver‚Äù, que act√∫an como disparadores de la l√≥gica de autenticaci√≥n.

En conjunto, este flujo evidencia c√≥mo login conecta la interfaz de usuario, la validaci√≥n de credenciales y la navegaci√≥n inicial dentro de la aplicaci√≥n.

***Los casos de uso considerados en esta pantalla, son:***

    1. La carga de la pantalla de acceso
    2. La captura de credenciales del usuario
    3. La validaci√≥n contra la base de datos.
    4. si la contrase√±a es inv√°lida, se impide el acceso
    5. Si existe una orden sin finalizar, al pasar exitosamente el login,
       se debe poder ver la opci√≥n de "Retomar Orden"

[üìÇ Ver documento  >  "flow_login.drawio"](flow_login.drawio)  

![Flujo Login](screenshots/flow_login.drawio.png)  

---

## üì¶ Tomar Pedido - (tomar_pedido.py)

***Descripci√≥n:***
Este diagrama describe el flujo de toma de pedido del m√≥dulo tomar_pedido. Los nodos representan sus m√©todos y handlers de interfaz (p. ej., inicializaci√≥n de pantalla, capturas de entrada y validaciones), mientras que las aristas s√≥lidas muestran la secuencia interna entre pasos como preparar el formulario, validar campos y construir el objeto de pedido.

Las aristas punteadas reflejan las invocaciones hacia otros m√≥dulos (por ejemplo, actualizaci√≥n/consulta en carrito o traspaso del contexto a resumen_cliente), y los enlaces de eventos de UI (on_release, bind) act√∫an como disparadores entre componentes.

Cuando corresponde, el grafo incluye la fuente de datos SQLite y las operaciones SQL relevantes (p. ej., SELECT para productos o clientes y INSERT/UPDATE para persistir el pedido), evidenciando la integraci√≥n entre la l√≥gica de la pantalla y la capa de datos.

En conjunto, el diagrama ofrece una vista compacta de c√≥mo tomar_pedido orquesta la captura, validaci√≥n y env√≠o del pedido, y c√≥mo colabora con m√≥dulos vecinos para completar el proceso.

***Los casos de uso considerados en esta pantalla, son:***

    - Si previamente, se la app se cerr√≥, sin finalizar el pedido, se guarda un registro en la tabla order_drafts, 
      si al ingresar a este m√≥dulo, ese registro existe, se habilita un bot√≥n que permite ***‚ÄúRetomar la orden‚Äù***

    - Si no existe un registro en la tabla ‚Äúorder_drafts‚Äù, el bot√≥n no se habilita

    - Si el bot√≥n est√° habilitado, el usuario puede hacer clic en el bot√≥n y pasa directamente a retomar 
      el pedido anterior, que se guard√≥ en la tabla ***‚Äúorder_drafts‚Äù***

    - El usuario puede buscar a su cliente usando los siguientes criterios, ‚Äúnombre de fantas√≠a‚Äù 
      ‚Äúnombre real‚Äù y ‚Äúrut‚Äù, esos datos los busca en la tabla ***‚Äúclientes‚Äù***

    - A medida que se van ingresando datos, se despliegan sugerencias que coincidan con la b√∫squeda realizada por 
      el cliente

    - Se despliega un bot√≥n que permite ir a m√≥dulo llamado **‚Äúhistorial.py‚Äù**

    - Se despliega un bot√≥n que permite cerrar la sesi√≥n y salir de la aplicaci√≥n

[üìÇ Ver documento  >  "flow_tomar_pedido.drawio"](flow_tomar_pedido.drawio)  

![Flujo Tomar Pedido](screenshots/flow_tomar_pedido.drawio.png)  

---

## üë§ Resumen Cliente - (resumen_cliente.py)

***Descripci√≥n:***
Este diagrama representa el flujo de selecci√≥n y confirmaci√≥n de cliente en el m√≥dulo resumen_cliente.
Los nodos corresponden a las funciones responsables de cargar los registros desde la base de datos, mostrar la informaci√≥n en pantalla y habilitar la interacci√≥n del usuario mediante botones y eventos (on_release, bind).

Las aristas s√≥lidas reflejan la l√≥gica interna del m√≥dulo, como la preparaci√≥n de la vista y la actualizaci√≥n de datos, mientras que las aristas punteadas se√±alan las llamadas hacia otros m√≥dulos, en especial la transici√≥n hacia tomar_pedido una vez seleccionado el cliente.

El diagrama tambi√©n incorpora las consultas SQL sobre todoferre.db, destacando operaciones SELECT sobre la tabla de clientes, lo que evidencia la dependencia del m√≥dulo con la fuente de datos.

En conjunto, este flujo muestra c√≥mo resumen_cliente act√∫a como puente entre la selecci√≥n del cliente y la continuaci√≥n del proceso de pedido, coordinando interfaz, datos y navegaci√≥n hacia los siguientes pasos de la aplicaci√≥n.

***Los casos de uso considerados en esta pantalla, son:***

    -Se despliegan en pantalla los datos de cliente seleccionado previamente en la pantalla ‚Äútomar_pedido.py‚Äù
    -Los datos desplegados, seg√∫n el requerimiento del cliente son:

        - "RUT‚Äù, obtenido de "numero_identificacion_fiscal"
        - "Direcci√≥n", obtenido de "direccion_completa"
        - "Tipo de Pago", obtenido de  "terminos_de_pago_del_cliente"
        - "Comuna" , obtenido de "comuna"
        - "Ciudad", obtenido de "ciudad"
        - "Regi√≥n", obtenido de "estado"
        - "Vendedor", obtenido de "vendedor"
        - ‚ÄúEmail" , obtenido de "correo_electronico"

    - Si el usuario nota que el cliente que escogi√≥, no es el correcto, tiene un bot√≥n que le permite regresar a 
    la pantalla anterior, en donde hacer una nueva b√∫squeda de cliente
    
    - El usuario no puede continuar a la siguiente pantalla, si no escoge una opci√≥n para despacho
  
    - Si los datos del cliente no consideran una regi√≥n, se despliega una opci√≥n obligatoria para 
    ingresar esta informaci√≥n, este dato, es esencial, puesto que en la siguiente pantalla, donde se ingresan 
    los productos, la lista de precios no es la misma para cada regi√≥n del pa√≠s (se puede dar el caso 
    que un SKU tenga el mismo precio en Valpara√≠so y Santiago, sin embargo, ese dato no es relevante para la 
    l√≥gica, debe siempre haber una regi√≥n seleccionada en los datos del cliente)

    - Si el cliente no tiene una regi√≥n seleccionada y escoge la opci√≥n ‚Äúretiro‚Äù, puede seguir a 
    la siguiente pantalla, pues el requerimiento fue que los precios que se mostrar√°n en la siguiente pantalla, 
    son los de la regi√≥n metropolitana

    - Si el usuario escoge la opci√≥n ‚Äúdespacho‚Äù y en los datos del cliente hay datos en la columna de ‚Äúestado‚Äù, 
    el usuario puede seguir a la siguiente pantalla

    - Se despliega un cuadro de ‚ÄúNotas:‚Äù, en donde el usuario ingresa texto

[üìÇ Ver documento  >  "flow_resumen_cliente.drawio"](low_resumen_cliente.drawio)  

![Flujo Resumen Cliente](screenshots/flow_resumen_cliente.drawio.png)  

---

## üìú Historial - (historial.py)

***Descripci√≥n:***
Este diagrama representa el flujo de consulta y gesti√≥n del historial de pedidos en el m√≥dulo historial.

Los nodos corresponden a las funciones que se ejecutan al cargar la pantalla, recuperar los registros desde la base de datos y poblar la interfaz con los pedidos previos. Las aristas s√≥lidas muestran la secuencia interna entre m√©todos como on_pre_enter() y _reload(), encargados de preparar y actualizar la vista, mientras que las aristas punteadas reflejan la interacci√≥n con otros m√≥dulos, en especial la invocaci√≥n a pdf_pedido para la generaci√≥n de comprobantes en PDF.

El diagrama tambi√©n incorpora las operaciones SQL sobre todoferre.db, principalmente consultas SELECT a la tabla de pedidos (orders), que permiten mostrar la informaci√≥n hist√≥rica al usuario. Asimismo, se incluyen los eventos de interfaz (botones como ‚ÄúGenerar PDF‚Äù y ‚ÄúVolver‚Äù) que act√∫an como disparadores de las acciones disponibles en la pantalla. En conjunto, este flujo muestra c√≥mo historial integra interfaz, persistencia de datos y salida documental, ofreciendo al usuario una vista completa de pedidos previos con opciones de exportaci√≥n.

***Los casos de uso considerados en esta pantalla, son:***

    - Se despliegan en pantalla los registros guardados en la tabla "orders"
    - Si se generan nuevos registros despu√©s de completar una orden, deben desplegarse inmediatamente en esta pantalla
    - Si la orden no se comppleta, no deben aparecer registros desde la tabla "orders"
    - Cada uno de los registros hist√≥ricos, debe tener un bot√≥n asociado para "Generar PDF"
    - Cada registro historico desplegados, debe contener:
         "n√∫mero de serie de la orden"
         "Nombre del cliente"
         "monto de la compra" 
         "fecha y hora"
    - Debe existir un bot√≥n que permita regresar a la pantalla previa (tomar_orden.py)

[üìÇ Ver documento  >  draw.io](flow_historial.drawio)  
![Flujo Historial](screenshots/flow_historial.drawio.png)  

---

## üõí Carrito - (carrito.py)

***Descripci√≥n:***
Este diagrama detalla el flujo de armado y mantenimiento del carrito en el m√≥dulo carrito.

Los nodos representan funciones que inicializan la vista, hidratan el carrito (desde memoria o consulta previa), y gestionan l√≠neas de pedido:

        -Agregar √≠tems
        -Actualizar cantidades (incremento/decremento)
        -Eliminar productos
        -Vaciar

Las aristas s√≥lidas reflejan la secuencia interna habitual:

        -evento de UI (on_release en botones como ‚Äú+‚Äù, ‚Äú‚àí‚Äù)
        -‚ÄúEliminar‚Äù
        -‚ÄúVaciar‚Äù
        -‚ÄúSiguiente‚Äù
        -validaciones (producto v√°lido, cantidad > 0, disponibilidad/stock)
        -mutaci√≥n del carrito
        -re-c√°lculo de totales (subtotal, descuentos, impuestos si aplica)
        -refresco de la interfaz y,
        -cuando corresponde, persistencia.

Las aristas punteadas indican llamadas entre m√≥dulos, por ejemplo:

        -hacia resumen_cliente para continuar el proceso con los datos seleccionados
        -hacia tomar_pedido en flujos de ida/vuelta
        -o hacia pdf_pedido cuando se emite una cotizaci√≥n/boleta directa desde el carrito

El grafo incorpora la interacci√≥n con todoferre.db, con operaciones:

        -SELECT para obtener precio/stock de productos
        -INSERT/UPDATE en la tabla de l√≠neas de pedido (p. ej., order_items) al agregar/modificar cantidades
        -DELETE al eliminar √≠tems y, en la confirmaci√≥n
        -INSERT del encabezado en orders.

En conjunto, el diagrama muestra c√≥mo carrito orquesta eventos de interfaz, reglas de negocio y acceso a datos, garantizando que cada acci√≥n del usuario se traduzca en un estado de carrito coherente, totales recalculados y una transici√≥n limpia hacia los siguientes pasos del proceso de venta.

***Los casos de uso considerados en esta pantalla, son:***

    - Se deben desplegar la informaci√≥n de regi√≥n (influye en la lista de precios)
    - Se debe desplegar el nombre del cliente (se trae de "resumen_cliente.py)
    - Se debe desplegar un cuadro de busqueda din√°mica
    - Se puede hacer una busqueda por sku o nombre de productoi
    - Los resultados de busqueda son din√°micos en el despliegue
    - Al desplegarse los resultados, a estos se les puede hacer clic
    - Al hacer clic en el resultado, este se agrega automaticamente al carrito
    - Cuando el producto est√° en el carrito, se puede sumar, restar o eliminar
    - Si se hace clic varias veces en el resultado de busqueda, se agregan productos = clic
    - Cuando se agregan productos, las cantidades de "Subtotal" cambian
    - Cuando se agregan productos, las cantidades de "Total" cambian
    - La cantidad "Total" est√° sujeta a IVA (19%)
    - Mientras se est√° haciendo la orden, se escribe un registro en la tabla "order_drafts"
    - Si se cierra la app, los datos de "order_drafts", retoman la sesi√≥n
    - Una vez que se presiona "Finalizar Orden", se borran los datos de "order_drafts"
    - Una vez que se presiona "Finalizar Orden", se redirige al usuario a la pantalla para buscar cliente
    - El finalizar la orden, se genera un numero de orden que se compone de (nombre de usuario + num ramdom(5))
    - Al finalizar la orden, debe quedar un registro que se vea en "Historial" (se escribe en tabla "orders")
    - Se debe desplegar un boton "Volver"
    - El bot√≥n "Volver", lleva al usuario a la pantalla "Resumen Cliente"

[üìÇ Ver documento > flow_carrito.drawio](flow_carrito.drawio)  
![Flujo Carrito](screenshots/flow_carrito.drawio.png)  

---

## üìù PDF Pedido - (pdf_pedido.py)

***Descripci√≥n:***
Este diagrama describe el flujo de generaci√≥n de documentos PDF en el m√≥dulo pdf_pedido.

Los nodos representan las funciones que se encargan de recibir los datos del pedido, estructurar la informaci√≥n y renderizarla en formato PDF.

Las aristas s√≥lidas muestran la secuencia l√≥gica dentro del m√≥dulo, desde la preparaci√≥n de contenido hasta la escritura del archivo en disco, mientras que las aristas punteadas indican las llamadas provenientes de otros m√≥dulos, como historial o tomar_pedido, que invocan la funcionalidad para producir el comprobante del pedido.

El diagrama tambi√©n resalta la interacci√≥n con la fuente de datos SQLite, utilizada para obtener la informaci√≥n del pedido antes de la exportaci√≥n, y la presencia de eventos que act√∫an como disparadores (por ejemplo, botones de interfaz que inician la exportaci√≥n).

En conjunto, este flujo deja en evidencia c√≥mo pdf_pedido funciona como un m√≥dulo especializado en la salida documental, sirviendo de punto final para transformar los registros del sistema en un archivo legible y transportable.

***Los casos de uso considerados en esta pantalla, son:***

    - Generar PDF no es una p√°gina, es una funcionalidad que se muestra como bot√≥n
    - El bot√≥n de "Imprimir PDF", se muestra en la pagina de "Historial"
    - En Android, al generar el PDF, se abre con la app para PDF. que funcione en el dispositivo
    - Se usa una app random, ya que se evita que el usuario deba buscar donde queda el PDF al ser generado
    - Para la primera compilaci√≥n para Android, se deshabilit√≥ la generaci√≥n del PDF
    - Los datos de la generaci√≥n de PDF se leen desde "orders"
    - El PDF que se genera, tiene el logo "todoferretero" en el costado superior izquierdo
    - El PDF tiene el titulo de "Pedido" en el costado superior derecho
    - El PDF tiene la fecha y hora de cuando fue generado el pedido
    - El PDF tiene un numero de orden que se genera aleatoreamente usando el nombre del usuario y un numero random
    - El PDF informa quien realiz√≥ la orden tras el texto "Realizado por:"
    - El PDF incluye texto "Se√±or(es):" nombre del cliente 
    - El PDF incluye "Direcci√≥n:", direcci√≥n cliente tabla "orders"
    - El PDF incluye "Forma de Pago:", forma de pago tabla "orders"
    - El PDF incluye "Direcci√≥n de Despacho:", direcci√≥n de tabla "orders"
    - EL PDF muestra la info de "Lista de Precios:", "region" desde tabla "orders"
    - El PDF muestra "RUT:", de la tabla "orders"
    - El PDF muestra "Comuna:", despliega la comuna desde la tabla "orders"
    - El PDF muestra "Ciudad", despliega la info de la tabla "orders"
    - El PDF muestra "Email:", despliega la imfo de la tabla "orders"

[üìÇ Ver documento > flow_pdf_pedido.drawio](flow_pdf_pedido.drawio)  
![Flujo PDF Pedido](screenshots/flow_pdf_pedido.drawio.png)  

---
